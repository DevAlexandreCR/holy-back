generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String         @id @default(uuid()) @db.Char(36)
  name                String
  email               String         @unique
  passwordHash        String         @map("password_hash")
  createdAt           DateTime       @default(now()) @map("created_at")
  updatedAt           DateTime       @updatedAt @map("updated_at")
  resetToken          String?        @map("reset_token")
  resetTokenExpiresAt DateTime?      @map("reset_token_expires_at")
  settings            UserSettings?
  verseHistory        UserVerseHistory[]

  @@map("users")
}

model BibleVersion {
  id        Int           @id @default(autoincrement())
  apiCode   String        @unique @map("api_code")
  name       String
  language  String
  isActive  Boolean       @default(true) @map("is_active")
  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")
  settings  UserSettings[]
  translations VerseTranslation[]

  @@map("bible_versions")
}

model UserSettings {
  id                 Int           @id @default(autoincrement())
  userId             String        @map("user_id")
  preferredVersionId Int?          @map("preferred_version_id")
  timezone           String?
  createdAt          DateTime      @default(now()) @map("created_at")
  updatedAt          DateTime      @updatedAt @map("updated_at")
  user               User          @relation(fields: [userId], references: [id])
  preferredVersion   BibleVersion? @relation(fields: [preferredVersionId], references: [id])

  @@unique([userId])
  @@map("user_settings")
}

model VerseSeed {
  id                 Int                 @id @default(autoincrement())
  seedHash           String              @unique @map("seed_hash")
  sourceTranslation  String              @default("web") @map("source_translation")
  reference          String
  referenceBook      String              @map("reference_book")
  referenceChapter   Int                 @map("reference_chapter")
  referenceFromVerse Int                 @map("reference_from_verse")
  referenceToVerse   Int?                @map("reference_to_verse")
  textEn             String              @db.Text @map("text_en")
  meta               Json?
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")

  translations       VerseTranslation[]
  userHistory        UserVerseHistory[]

  @@index([sourceTranslation])
  @@map("verse_seeds")
}

model VerseTranslation {
  id               Int          @id @default(autoincrement())
  seedId           Int          @map("seed_id")
  versionId        Int          @map("version_id")
  translationCode  String       @map("translation_code")
  text             String       @db.Text
  meta             Json?
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")

  seed             VerseSeed    @relation(fields: [seedId], references: [id])
  version          BibleVersion @relation(fields: [versionId], references: [id])

  @@unique([seedId, versionId])
  @@index([versionId])
  @@map("verse_translations")
}

model UserVerseHistory {
  id        Int       @id @default(autoincrement())
  userId    String    @map("user_id")
  seedId    Int       @map("seed_id")
  shownAt   DateTime  @default(now()) @map("shown_at")

  seed      VerseSeed @relation(fields: [seedId], references: [id])
  user      User      @relation(fields: [userId], references: [id])

  @@unique([userId, seedId])
  @@index([userId])
  @@map("user_verse_history")
}
